<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-storage.js" type="module"></script>
</head>
<body class="vancouver-page"> 
    <div class="main">
        <nav>
            <!-- Display logo -->
            <div class="logo">
                <a href="./index.html">
                    <img src="planeLogo.png" alt="logo">
                </a>
            </div>
            <!-- Display navigation links -->
            <div class="nav-links">
                <ul>
                    <li><a href="./index.html">Home</a></li>
                    <li><a href="./budget.html">Budget</a></li>
                    <li><a href="./vancouverItinerary.html">Itinerary</a></li>
                    <li><a href="./vangallery.html">Gallery</a></li>
                </ul>
            </div>
        </nav>
        
        <div class="content">
            <h1>Photo Gallery</h1>
            <!-- Allow uploads -->
            <div class="upload-container">
                <input type="file" id="fileInput" accept="image/*" multiple>
                <button id="uploadBtn">Upload</button>
            </div>
            <div class="gallery" id="gallery"></div>
        </div>
        
        <!-- Close enlarged images -->
        <div id="imageModal" class="modal">
            <span class="close">&times;</span>
            <img class="modal-content" id="enlargedImg">
        </div>
    </div>

    <script type="module">
        // Import Firebase SDKs as ES modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js";
        import { getStorage, ref, listAll, getDownloadURL, uploadBytes } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-storage.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCl4bd1A-6-HRYIcbgGfT02mQI73UWSa0s",
            authDomain: "digitalpassport-e49cb.firebaseapp.com",
            projectId: "digitalpassport-e49cb",
            storageBucket: "digitalpassport-e49cb.appspot.com",
            messagingSenderId: "1075577493433",
            appId: "1:1075577493433:web:1ea586b546d503dac98868"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Function to display images in the gallery
        function addImageToGallery(src, filename) {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'img-container';

                const img = document.createElement('img');
                img.src = src;
                img.alt = filename; // Use filename or any appropriate alt text
                img.onclick = function() {
                    modal.style.display = 'block';
                    modalImg.src = src;
                };
                imgContainer.appendChild(img);

                gallery.appendChild(imgContainer);
        } 

        // Function to fetch images from Firebase Storage
        function fetchImagesFromStorage() {
                const storageRef = ref(storage, 'uploads');
                listAll(storageRef)
                    .then((result) => {
                        result.items.forEach((imageRef) => {
                            getDownloadURL(imageRef)
                                .then((url) => {
                                    addImageToGallery(url, imageRef.name);
                                })
                                .catch((error) => {
                                    console.error('Error getting download URL:', error);
                                });
                        });
                    })
                    .catch((error) => {
                        console.error('Error listing images:', error);
                    });
        }

        
        fetchImagesFromStorage();

        document.addEventListener('DOMContentLoaded', function() {
            const gallery = document.getElementById('gallery');
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('enlargedImg');
            const span = document.getElementsByClassName('close')[0];

            // Function to upload image to Firebase Storage
            document.getElementById('uploadBtn').addEventListener('click', function() {
                const files = document.getElementById('fileInput').files;
                const uploadTasks = [];

                for (const file of files) {
                    const storageRef = ref(storage, `uploads/${file.name}`);
                    const uploadTask = uploadBytes(storageRef, file);

                    uploadTasks.push(uploadTask);
                }

                Promise.all(uploadTasks)
                    .then(() => {
                        console.log('Files uploaded successfully!');
                        fetchImagesFromStorage(); // Call function to fetch images after upload
                    })
                    .catch(error => {
                        console.error('Error uploading files:', error);
                    });
            });

            

            

            // Close modal when clicking on close button (x)
            span.onclick = function() {
                modal.style.display = 'none';
            };

            // Close modal when clicking outside of the modal
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            };
        });
    </script>
</body>
</html>
